<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Richard Wen richard.wen@utoronto.ca" />

<meta name="date" content="2024-12-16" />

<title>Quarterly Collisions in Bloor, University, Danforth, and Yonge</title>

<script src="index_files/header-attrs-2.29/header-attrs.js"></script>
<script src="index_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="index_files/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="index_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="index_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<link href="index_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="index_files/pagedtable-1.1/js/pagedtable.js"></script>
<link href="index_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="index_files/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="index_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="index_files/datatables-binding-0.33/datatables.js"></script>
<link href="index_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="index_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="index_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<script src="index_files/jszip-1.13.6/jszip.min.js"></script>
<link href="index_files/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css" rel="stylesheet" />
<script src="index_files/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js"></script>
<script src="index_files/dt-ext-buttons-1.13.6/js/buttons.html5.min.js"></script>
<script src="index_files/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js"></script>
<script src="index_files/dt-ext-buttons-1.13.6/js/buttons.print.min.js"></script>
<link href="index_files/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="index_files/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="index_files/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="index_files/selectize-0.12.0/selectize.min.js"></script>
<link href="index_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="index_files/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Quarterly Collisions in Bloor, University,
Danforth, and Yonge</h1>
<h3 class="subtitle">R Code</h3>
<h4 class="author">Richard Wen <a href="mailto:richard.wen@utoronto.ca"
class="email">richard.wen@utoronto.ca</a></h4>
<h4 class="date">December 16, 2024</h4>

</div>


<div id="libraries" class="section level1">
<h1>Libraries</h1>
<p>Load libraries, the main ones being used are <code>ggplot2</code> for
plotting, <code>leaflet</code> and <code>tmap</code> for interactive
maps, <code>sf</code> for spatial data processing,
<code>tidyverse</code> for data processing, and <code>DT</code> for
interactive tables.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(leaflet.extras)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">library</span>(DT)</span></code></pre></div>
</div>
<div id="functions" class="section level1">
<h1>Functions</h1>
<p>Create a function to assign default behaviour for our <code>DT</code>
datatables.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Function for default datatable params</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>datatable <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="co"># Build arg list</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    args <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    </span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    <span class="co"># Default custom filename</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    filename <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;filename&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(args)) <span class="st">&quot;data&quot;</span> <span class="cf">else</span> args<span class="sc">$</span>filename</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    args[[<span class="st">&quot;filename&quot;</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    </span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="co"># Add default extensions</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    args<span class="sc">$</span>extensions <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;extensions&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(args)) <span class="st">&quot;Buttons&quot;</span> <span class="cf">else</span> args<span class="sc">$</span>extensions</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>    </span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    <span class="co"># Add default args</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>    args<span class="sc">$</span>filter <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;filter&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(args)) <span class="st">&quot;top&quot;</span> <span class="cf">else</span> args<span class="sc">$</span>filter</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>    args<span class="sc">$</span>fillContainer <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;fillContainer&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(args)) T <span class="cf">else</span> args<span class="sc">$</span>fillContainer</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    </span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    <span class="co"># Add default options</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;options&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(args)) {</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>        args<span class="sc">$</span>options <span class="ot">&lt;-</span>  <span class="fu">list</span>(</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>            <span class="at">scrollY =</span> <span class="st">&quot;350px&quot;</span>,</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>            <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>                <span class="fu">list</span>(</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>                    <span class="at">extend =</span> <span class="st">&quot;csv&quot;</span>,</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>                    <span class="at">filename =</span> filename,</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>                    <span class="at">exportOptions =</span> <span class="fu">list</span>(<span class="at">columns =</span> <span class="st">&quot;:not(.rownames)&quot;</span>)</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>                ),</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>                <span class="fu">list</span>(</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>                    <span class="at">extend =</span> <span class="st">&quot;excel&quot;</span>,</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>                    <span class="at">filename =</span> filename,</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>                    <span class="at">exportOptions =</span> <span class="fu">list</span>(<span class="at">columns =</span> <span class="st">&quot;:not(.rownames)&quot;</span>),</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>                    <span class="at">title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>                )</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>            ),</span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>            <span class="at">columnDefs =</span> <span class="fu">list</span>(</span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>                <span class="fu">list</span>(</span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>                    <span class="at">targets =</span> <span class="dv">0</span>,</span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a>                    <span class="at">className =</span> <span class="st">&quot;rownames&quot;</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a>                )</span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a>            ),</span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a>            <span class="at">dom =</span> <span class="st">&quot;Bfrtip&quot;</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a>        )</span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a>    }</span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">do.call</span>(DT<span class="sc">::</span>datatable, args))</span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<p>Load the following data for the City of Toronto:</p>
<ul>
<li>boundary (<a
href="https://open.toronto.ca/dataset/regional-municipal-boundary/">url</a>)</li>
<li>centrelines (<a
href="https://open.toronto.ca/dataset/toronto-centreline-tcl/">url</a>)</li>
<li>all collisions (private)</li>
<li>verified bikeways (<a
href="https://github.com/rrwen/recovr-infracycle/blob/main/data/toronto-bikeways-preprocess-v3.geojson">url</a>)</li>
</ul>
<p>Toronto city boundaries data (last updated July 23, 2019) were
downloaded November 9, 2024, while Toronto centrelines data (last
updated December 6, 2024) were downlaoded December 6, 2024.</p>
<p>All collisions data (2010-2022) was provided by David McElroy <a
href="mailto:David.McElroy@toronto.ca"
class="email">David.McElroy@toronto.ca</a> from the City of Toronto on
November 7, 2024.</p>
<p>Verified bikeways data (2001 to 2022) originally downloaded by Konrad
Samsel <a href="mailto:konrad.samsel@mail.utoronto.ca"
class="email">konrad.samsel@mail.utoronto.ca</a> in January 2023 based
on Toronto Cycling Network data (<a
href="https://open.toronto.ca/dataset/cycling-network/">url</a>), and
last updated by Konrad on March 25, 2024. This data was later modified
by Richard Wen <a href="mailto:richard.wen@utoronto.ca"
class="email">richard.wen@utoronto.ca</a>, and was last updated October
27, 2024.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Load boundaries</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>bounds_raw <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;../../data/toronto-boundary-2019-07-23/citygcs_regional_mun_wgs84.shp&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Load toronto centrelines data</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>ctl_raw <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;../../data/toronto-centrelines-2024-12-06.geojson&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Load toronto bikeways data</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>bike_raw <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;../../data/toronto-bikeways-2024-10-27.geojson&quot;</span>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co"># Load all toronto collisions from 2022 to 2024</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>colli_raw <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    <span class="st">&quot;../../tmp/i0327_collisionsrep_acc_export.csv&quot;</span>,</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">c</span>(</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>        <span class="st">&quot;X_POSSIBLE_NAMES=LONGITUDE&quot;</span>,</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>        <span class="st">&quot;Y_POSSIBLE_NAMES=LATITUDE&quot;</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    ),</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="cleaning" class="section level1">
<h1>Cleaning</h1>
<p>For the collisions:</p>
<ol style="list-style-type: decimal">
<li>Crop all collision points to the boundaries of the City of
Toronto</li>
<li>Convert the accident date <code>ACCDATE</code> to <code>date</code>
type</li>
<li>Add a column to separate the collisions data for Killed or Seriously
Injured (KSI) (<code>INJURY</code> = 3 or 4) and non-KSI individuals
(<code>INJURY</code> = 1 or 2)</li>
<li>Add columns to identify drivers (and passengers,
<code>INVTYPE</code> = 01 or 02), pedestrians (<code>INVTYPE</code> =
03), cyclists (and cyclist passengers, <code>INVTYPE</code> = 04 or 05),
and other road users (all other <code>INVTYPE</code> values).</li>
</ol>
<p>For the verified bikeways:</p>
<ol style="list-style-type: decimal">
<li>Filter for Bloor Street, Danforth Street, Danforth Avenue,
University Avenue, and Yonge Street</li>
<li>Calculate the <code>final_type</code> and <code>final_year</code>
for each verified bikeway segment
<ul>
<li>The <code>final_type</code> is the latest infrastructure type after
all installations and upgrades</li>
<li>If the <code>verify_upgrade2_type</code> is the same as the
<code>verify_upgrade1_type</code> or the
<code>verify_upgrade1_type</code> is the same as the
<code>verify_install_type</code>, these are not considered upgrades and
either the lower <code>verify_upgrade1_type</code> or
<code>verify_install_type</code> respectively will be considered as the
<code>final_type</code></li>
</ul></li>
<li>Filter for all segments where the <code>final_type</code> is cycle
track</li>
<li>Combine both painted lane <code>PL</code> and buffered lanes
<code>BUF</code> into one category of <code>painted lane</code></li>
</ol>
<p>For the centrelines:</p>
<ol style="list-style-type: decimal">
<li>Extract target streets Bloor Street, Danforth Street/Avenue,
University Avenue, and Yonge Street</li>
<li>Spatially merge all segments for each target street</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Reproj city bounds to 4326</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>bounds <span class="ot">&lt;-</span> bounds_raw <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># Crop colli to toronto bounds and convert date type</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>colli <span class="ot">&lt;-</span> colli_raw <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="fu">st_intersection</span>(bounds) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">colli_date =</span> <span class="fu">as_date</span>(ACCDATE))</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># Add a columns for ksi and road users</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>ksi_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>nonksi_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>colli <span class="ot">&lt;-</span> colli <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>        <span class="at">ksi =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>            INJURY <span class="sc">%in%</span> ksi_codes <span class="sc">~</span> <span class="st">&quot;ksi&quot;</span>,</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>            INJURY <span class="sc">%in%</span> nonksi_codes <span class="sc">~</span> <span class="st">&quot;non_ksi&quot;</span>,</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>            <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>        ), <span class="co"># ksi col</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>        <span class="at">user =</span> <span class="fu">case_when</span>( <span class="co"># road user col</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>            INVTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;01&quot;</span>, <span class="st">&quot;02&quot;</span>) <span class="sc">~</span> <span class="st">&quot;driver&quot;</span>,</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>            INVTYPE <span class="sc">==</span> <span class="st">&quot;03&quot;</span> <span class="sc">~</span> <span class="st">&quot;pedestrian&quot;</span>,</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>            INVTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;04&quot;</span>, <span class="st">&quot;05&quot;</span>) <span class="sc">~</span> <span class="st">&quot;cyclist&quot;</span>,</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>            <span class="at">.default =</span> <span class="st">&quot;other&quot;</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>        )</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ksi))</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co"># Get cycle tracks only after all upgrades</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>bike <span class="ot">&lt;-</span> bike_raw <span class="sc">%&gt;%</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>    <span class="fu">filter</span>( <span class="co"># verified only</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>        (<span class="sc">!</span><span class="fu">is.na</span>(verify_install_year) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(verify_install_type)) <span class="sc">|</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>        (<span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade1_year) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade1_type)) <span class="sc">|</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>        (<span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade2_year) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade2_type))</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="co"># create col for target streets</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>        <span class="at">target_street =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>            <span class="fu">str_starts</span>(street, <span class="st">&quot;Bloor&quot;</span>) <span class="sc">~</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>                <span class="st">&quot;Bloor Street&quot;</span>,</span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>            <span class="fu">str_starts</span>(street, <span class="st">&quot;University&quot;</span>) <span class="sc">~</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>                <span class="st">&quot;University Avenue&quot;</span>,</span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>            <span class="fu">str_starts</span>(street, <span class="st">&quot;Yonge&quot;</span>) <span class="sc">~</span></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>                <span class="st">&quot;Yonge Street&quot;</span>,</span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>            <span class="fu">str_starts</span>(street, <span class="st">&quot;Danforth&quot;</span>) <span class="sc">~</span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>                <span class="st">&quot;Danforth Street/Avenue&quot;</span>,</span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>            <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a>        )</span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(target_street)) <span class="sc">%&gt;%</span></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>( <span class="co"># reclass to pl or ct</span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>        <span class="fu">c</span>(verify_install_type, verify_upgrade1_type, verify_upgrade2_type),</span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a>        <span class="sc">~</span> <span class="fu">case_when</span>(</span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a>            . <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BUF&quot;</span>, <span class="st">&quot;PL&quot;</span>) <span class="sc">~</span> <span class="st">&quot;painted lane&quot;</span>,</span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a>            . <span class="sc">==</span> <span class="st">&quot;PBL&quot;</span> <span class="sc">~</span> <span class="st">&quot;cycle track&quot;</span>,</span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a>            <span class="at">.default =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb4-55"><a href="#cb4-55" tabindex="-1"></a>        )</span>
<span id="cb4-56"><a href="#cb4-56" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb4-57"><a href="#cb4-57" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-58"><a href="#cb4-58" tabindex="-1"></a>        <span class="at">final_type =</span> <span class="fu">case_when</span>( <span class="co"># col for final type without improvements</span></span>
<span id="cb4-59"><a href="#cb4-59" tabindex="-1"></a>            verify_upgrade2_type <span class="sc">!=</span> <span class="st">&quot;none&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb4-60"><a href="#cb4-60" tabindex="-1"></a>            verify_upgrade2_type <span class="sc">!=</span> verify_upgrade1_type</span>
<span id="cb4-61"><a href="#cb4-61" tabindex="-1"></a>                <span class="sc">~</span> verify_upgrade2_type,</span>
<span id="cb4-62"><a href="#cb4-62" tabindex="-1"></a>            verify_upgrade1_year <span class="sc">!=</span> <span class="st">&quot;none&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb4-63"><a href="#cb4-63" tabindex="-1"></a>            verify_upgrade1_type <span class="sc">!=</span> verify_install_type</span>
<span id="cb4-64"><a href="#cb4-64" tabindex="-1"></a>                <span class="sc">~</span> verify_upgrade1_type,</span>
<span id="cb4-65"><a href="#cb4-65" tabindex="-1"></a>            verify_install_year <span class="sc">!=</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb4-66"><a href="#cb4-66" tabindex="-1"></a>                <span class="sc">~</span> verify_install_type,</span>
<span id="cb4-67"><a href="#cb4-67" tabindex="-1"></a>            <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb4-68"><a href="#cb4-68" tabindex="-1"></a>        ),</span>
<span id="cb4-69"><a href="#cb4-69" tabindex="-1"></a>        <span class="at">final_year =</span> <span class="fu">case_when</span>( <span class="co"># col for final year without improvements</span></span>
<span id="cb4-70"><a href="#cb4-70" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade2_year) <span class="sc">&amp;</span></span>
<span id="cb4-71"><a href="#cb4-71" tabindex="-1"></a>            verify_upgrade2_type <span class="sc">!=</span> verify_upgrade1_type</span>
<span id="cb4-72"><a href="#cb4-72" tabindex="-1"></a>                <span class="sc">~</span> verify_upgrade2_year,</span>
<span id="cb4-73"><a href="#cb4-73" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade1_year) <span class="sc">&amp;</span></span>
<span id="cb4-74"><a href="#cb4-74" tabindex="-1"></a>            verify_upgrade1_type <span class="sc">!=</span> verify_install_type</span>
<span id="cb4-75"><a href="#cb4-75" tabindex="-1"></a>                <span class="sc">~</span> verify_upgrade1_year,</span>
<span id="cb4-76"><a href="#cb4-76" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_install_year)</span>
<span id="cb4-77"><a href="#cb4-77" tabindex="-1"></a>                <span class="sc">~</span> verify_install_year,</span>
<span id="cb4-78"><a href="#cb4-78" tabindex="-1"></a>            <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb4-79"><a href="#cb4-79" tabindex="-1"></a>        ),</span>
<span id="cb4-80"><a href="#cb4-80" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-81"><a href="#cb4-81" tabindex="-1"></a>    <span class="fu">filter</span>( <span class="co"># filter for cycle tracks only</span></span>
<span id="cb4-82"><a href="#cb4-82" tabindex="-1"></a>        final_type <span class="sc">==</span> <span class="st">&quot;cycle track&quot;</span></span>
<span id="cb4-83"><a href="#cb4-83" tabindex="-1"></a>    )</span>
<span id="cb4-84"><a href="#cb4-84" tabindex="-1"></a></span>
<span id="cb4-85"><a href="#cb4-85" tabindex="-1"></a><span class="co"># Add history to bike lanes without improvements</span></span>
<span id="cb4-86"><a href="#cb4-86" tabindex="-1"></a>bike <span class="ot">&lt;-</span> bike <span class="sc">%&gt;%</span></span>
<span id="cb4-87"><a href="#cb4-87" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="co"># remove improvements</span></span>
<span id="cb4-88"><a href="#cb4-88" tabindex="-1"></a>        <span class="at">verify_upgrade1_year =</span> <span class="fu">if_else</span>(</span>
<span id="cb4-89"><a href="#cb4-89" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade1_type) <span class="sc">&amp;</span></span>
<span id="cb4-90"><a href="#cb4-90" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_install_type) <span class="sc">&amp;</span></span>
<span id="cb4-91"><a href="#cb4-91" tabindex="-1"></a>            verify_install_type <span class="sc">==</span> verify_upgrade1_type,</span>
<span id="cb4-92"><a href="#cb4-92" tabindex="-1"></a>            <span class="cn">NA</span>,</span>
<span id="cb4-93"><a href="#cb4-93" tabindex="-1"></a>            verify_upgrade1_year</span>
<span id="cb4-94"><a href="#cb4-94" tabindex="-1"></a>        ),</span>
<span id="cb4-95"><a href="#cb4-95" tabindex="-1"></a>        <span class="at">verify_upgrade1_type =</span> <span class="fu">if_else</span>(</span>
<span id="cb4-96"><a href="#cb4-96" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade1_type) <span class="sc">&amp;</span></span>
<span id="cb4-97"><a href="#cb4-97" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_install_type) <span class="sc">&amp;</span></span>
<span id="cb4-98"><a href="#cb4-98" tabindex="-1"></a>            verify_install_type <span class="sc">==</span> verify_upgrade1_type,</span>
<span id="cb4-99"><a href="#cb4-99" tabindex="-1"></a>            <span class="st">&quot;none&quot;</span>,</span>
<span id="cb4-100"><a href="#cb4-100" tabindex="-1"></a>            verify_upgrade1_type</span>
<span id="cb4-101"><a href="#cb4-101" tabindex="-1"></a>        ),</span>
<span id="cb4-102"><a href="#cb4-102" tabindex="-1"></a>        <span class="at">verify_upgrade2_year =</span> <span class="fu">if_else</span>(</span>
<span id="cb4-103"><a href="#cb4-103" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade2_type) <span class="sc">&amp;</span></span>
<span id="cb4-104"><a href="#cb4-104" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade1_type) <span class="sc">&amp;</span></span>
<span id="cb4-105"><a href="#cb4-105" tabindex="-1"></a>            verify_upgrade2_type <span class="sc">==</span> verify_upgrade1_type,</span>
<span id="cb4-106"><a href="#cb4-106" tabindex="-1"></a>            <span class="cn">NA</span>,</span>
<span id="cb4-107"><a href="#cb4-107" tabindex="-1"></a>            verify_upgrade2_year</span>
<span id="cb4-108"><a href="#cb4-108" tabindex="-1"></a>        ),</span>
<span id="cb4-109"><a href="#cb4-109" tabindex="-1"></a>        <span class="at">verify_upgrade2_type =</span> <span class="fu">if_else</span>(</span>
<span id="cb4-110"><a href="#cb4-110" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade2_type) <span class="sc">&amp;</span></span>
<span id="cb4-111"><a href="#cb4-111" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(verify_upgrade1_type) <span class="sc">&amp;</span></span>
<span id="cb4-112"><a href="#cb4-112" tabindex="-1"></a>            verify_upgrade2_type <span class="sc">==</span> verify_upgrade1_type,</span>
<span id="cb4-113"><a href="#cb4-113" tabindex="-1"></a>            <span class="st">&quot;none&quot;</span>,</span>
<span id="cb4-114"><a href="#cb4-114" tabindex="-1"></a>            verify_upgrade2_type</span>
<span id="cb4-115"><a href="#cb4-115" tabindex="-1"></a>        )</span>
<span id="cb4-116"><a href="#cb4-116" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-117"><a href="#cb4-117" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-118"><a href="#cb4-118" tabindex="-1"></a>        <span class="at">history =</span> <span class="fu">glue</span>(</span>
<span id="cb4-119"><a href="#cb4-119" tabindex="-1"></a>            <span class="st">&quot;{verify_install_type},{verify_install_year}&quot;</span>,</span>
<span id="cb4-120"><a href="#cb4-120" tabindex="-1"></a>            <span class="st">&quot; -&gt; {verify_upgrade1_type},{verify_upgrade1_year}&quot;</span>,</span>
<span id="cb4-121"><a href="#cb4-121" tabindex="-1"></a>            <span class="st">&quot; -&gt; {verify_upgrade2_type},{verify_upgrade2_year}&quot;</span>,</span>
<span id="cb4-122"><a href="#cb4-122" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb4-123"><a href="#cb4-123" tabindex="-1"></a>            <span class="fu">str_remove_all</span>(<span class="st">&quot; -&gt; none,NA|none,NA -&gt; |none,NA&quot;</span>)</span>
<span id="cb4-124"><a href="#cb4-124" tabindex="-1"></a>    )</span>
<span id="cb4-125"><a href="#cb4-125" tabindex="-1"></a></span>
<span id="cb4-126"><a href="#cb4-126" tabindex="-1"></a><span class="co"># Filter centrelines for Bloor, University and Yonge</span></span>
<span id="cb4-127"><a href="#cb4-127" tabindex="-1"></a>streets <span class="ot">&lt;-</span> ctl_raw <span class="sc">%&gt;%</span></span>
<span id="cb4-128"><a href="#cb4-128" tabindex="-1"></a>    <span class="fu">filter</span>( <span class="co"># filter for streets only</span></span>
<span id="cb4-129"><a href="#cb4-129" tabindex="-1"></a>        FEATURE_CODE_DESC <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb4-130"><a href="#cb4-130" tabindex="-1"></a>            <span class="st">&quot;Major Arterial&quot;</span>,</span>
<span id="cb4-131"><a href="#cb4-131" tabindex="-1"></a>            <span class="st">&quot;Major Arterial Ramp&quot;</span>,</span>
<span id="cb4-132"><a href="#cb4-132" tabindex="-1"></a>            <span class="st">&quot;Minor Arterial&quot;</span>,</span>
<span id="cb4-133"><a href="#cb4-133" tabindex="-1"></a>            <span class="st">&quot;Minor Arterial Ramp&quot;</span>,</span>
<span id="cb4-134"><a href="#cb4-134" tabindex="-1"></a>            <span class="st">&quot;Collector&quot;</span>,</span>
<span id="cb4-135"><a href="#cb4-135" tabindex="-1"></a>            <span class="st">&quot;Access Road&quot;</span>,</span>
<span id="cb4-136"><a href="#cb4-136" tabindex="-1"></a>            <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb4-137"><a href="#cb4-137" tabindex="-1"></a>            <span class="st">&quot;Laneway&quot;</span>,</span>
<span id="cb4-138"><a href="#cb4-138" tabindex="-1"></a>            <span class="st">&quot;Local&quot;</span></span>
<span id="cb4-139"><a href="#cb4-139" tabindex="-1"></a>        )</span>
<span id="cb4-140"><a href="#cb4-140" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-141"><a href="#cb4-141" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="co"># create col for streets bloor, uni, and yonge</span></span>
<span id="cb4-142"><a href="#cb4-142" tabindex="-1"></a>        <span class="at">target_street =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-143"><a href="#cb4-143" tabindex="-1"></a>            <span class="fu">str_starts</span>(</span>
<span id="cb4-144"><a href="#cb4-144" tabindex="-1"></a>                LINEAR_NAME_FULL_LEGAL,</span>
<span id="cb4-145"><a href="#cb4-145" tabindex="-1"></a>                <span class="st">&quot;Bloor Street&quot;</span></span>
<span id="cb4-146"><a href="#cb4-146" tabindex="-1"></a>            ) <span class="sc">~</span> <span class="st">&quot;Bloor Street&quot;</span>,</span>
<span id="cb4-147"><a href="#cb4-147" tabindex="-1"></a>            <span class="fu">str_starts</span>(</span>
<span id="cb4-148"><a href="#cb4-148" tabindex="-1"></a>                LINEAR_NAME_FULL_LEGAL,</span>
<span id="cb4-149"><a href="#cb4-149" tabindex="-1"></a>                <span class="st">&quot;University Avenue&quot;</span></span>
<span id="cb4-150"><a href="#cb4-150" tabindex="-1"></a>            ) <span class="sc">~</span> <span class="st">&quot;University Avenue&quot;</span>,</span>
<span id="cb4-151"><a href="#cb4-151" tabindex="-1"></a>            <span class="fu">str_starts</span>(</span>
<span id="cb4-152"><a href="#cb4-152" tabindex="-1"></a>                LINEAR_NAME_FULL_LEGAL,</span>
<span id="cb4-153"><a href="#cb4-153" tabindex="-1"></a>                <span class="st">&quot;Yonge Street&quot;</span></span>
<span id="cb4-154"><a href="#cb4-154" tabindex="-1"></a>            ) <span class="sc">~</span> <span class="st">&quot;Yonge Street&quot;</span>,</span>
<span id="cb4-155"><a href="#cb4-155" tabindex="-1"></a>            <span class="fu">str_starts</span>( <span class="co"># Prince Edward Viaduct</span></span>
<span id="cb4-156"><a href="#cb4-156" tabindex="-1"></a>                LINEAR_NAME_FULL_LEGAL,</span>
<span id="cb4-157"><a href="#cb4-157" tabindex="-1"></a>                <span class="st">&quot;Danforth Avenue|Danforth Street&quot;</span></span>
<span id="cb4-158"><a href="#cb4-158" tabindex="-1"></a>            ) <span class="sc">~</span> <span class="st">&quot;Danforth Street/Avenue&quot;</span>,</span>
<span id="cb4-159"><a href="#cb4-159" tabindex="-1"></a>            <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb4-160"><a href="#cb4-160" tabindex="-1"></a>        )</span>
<span id="cb4-161"><a href="#cb4-161" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-162"><a href="#cb4-162" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(target_street)) <span class="sc">%&gt;%</span></span>
<span id="cb4-163"><a href="#cb4-163" tabindex="-1"></a>    <span class="fu">group_by</span>(target_street) <span class="sc">%&gt;%</span> <span class="co"># merge geoms on streets</span></span>
<span id="cb4-164"><a href="#cb4-164" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">geometry =</span> <span class="fu">st_union</span>(geometry))</span></code></pre></div>
</div>
<div id="processing" class="section level1">
<h1>Processing</h1>
<p>Find all collision points within 25 meters of the verified bikeways
on Yonge, Bloor, Danforth, and University.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Get row indices of nearest bikeway to each collision</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>near_idx <span class="ot">&lt;-</span> colli <span class="sc">%&gt;%</span> <span class="fu">st_nearest_feature</span>(bike)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># Calc distances to nearest bikeway for each collision</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>colli_bike <span class="ot">&lt;-</span> colli <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="co"># calc dist to nearest bikeway for each ksi</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>        <span class="st">`</span><span class="at">near_bike_meters</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">st_distance</span>(</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>            geometry,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>            bike[near_idx, ],</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>            <span class="at">by_element =</span> T</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    )</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co"># Get df version of bike and calc lens</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>bike_df <span class="ot">&lt;-</span> bike <span class="sc">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>        <span class="at">bike_len_km =</span> <span class="fu">as.numeric</span>(<span class="fu">st_length</span>(geometry)) <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>    as_tibble <span class="sc">%&gt;%</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>geometry)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co"># Add bike columns to collisions</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>colli_bike <span class="ot">&lt;-</span> colli_bike <span class="sc">%&gt;%</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="co"># add ids for bike</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>        <span class="at">bike_id =</span> bike_df[near_idx, ]<span class="sc">$</span>id</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>    <span class="fu">left_join</span>( <span class="co"># add bike cols to colli</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>        bike_df,</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">join_by</span>(bike_id <span class="sc">==</span> id)</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>    )</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="co"># Filter for collisions within 25 meters of the bikeways</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>colli_bike <span class="ot">&lt;-</span> colli_bike <span class="sc">%&gt;%</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>    <span class="fu">filter</span>(near_bike_meters <span class="sc">&lt;=</span> <span class="dv">25</span>)</span></code></pre></div>
<p>Calculate bikeway infrastructure types for all years by segment using
the installation and upgrade history.</p>
<p>All years before the first installation are considered to have no
infrastructure, while all years on or after the first installation is
considered the type of the first installation, up until the first
upgrade.</p>
<p>All years on or after the first upgrade is considered the type of the
first upgrade up until the second upgrade.</p>
<p>Finally, all years on or after the second upgrade is considered the
type of the second upgrade onwards.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Convert into bike events</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>bike_proc <span class="ot">&lt;-</span> bike <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>            verify_install_type,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>            verify_upgrade1_type,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>            verify_upgrade2_type</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>        ),</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">&quot;type_column&quot;</span>,</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">&quot;type&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type)) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>            type_column <span class="sc">==</span> <span class="st">&quot;verify_install_type&quot;</span> <span class="sc">~</span> verify_install_year,</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>            type_column <span class="sc">==</span> <span class="st">&quot;verify_upgrade1_type&quot;</span> <span class="sc">~</span> verify_upgrade1_year,</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>            type_column <span class="sc">==</span> <span class="st">&quot;verify_upgrade2_type&quot;</span> <span class="sc">~</span> verify_upgrade2_year</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>        )</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>        <span class="at">street_orig =</span> street,</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>        <span class="at">street =</span> target_street,</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>        <span class="at">segment_id =</span> id</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>        street,</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>        year,</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>        segment_id,</span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>        type</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>    as_tibble <span class="sc">%&gt;%</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>geometry) <span class="sc">%&gt;%</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year))</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="co"># Fill out the type for all years</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a>min_year <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">year</span>(colli_bike<span class="sc">$</span>colli_date), <span class="at">na.rm =</span> T)</span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a>max_year <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">year</span>(colli_bike<span class="sc">$</span>colli_date), <span class="at">na.rm =</span> T)</span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a>bike_proc <span class="ot">&lt;-</span> bike_proc <span class="sc">%&gt;%</span></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a>    <span class="fu">group_by</span>(street) <span class="sc">%&gt;%</span></span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a>    <span class="fu">group_map</span>(<span class="sc">~</span>{ <span class="co"># get all possible years</span></span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a>        <span class="fu">expand.grid</span>(</span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a>            <span class="at">street =</span> <span class="fu">unique</span>(.x<span class="sc">$</span>street),</span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a>            <span class="at">year =</span> min_year<span class="sc">:</span>max_year,</span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a>            <span class="at">segment_id =</span> <span class="fu">unique</span>(.x<span class="sc">$</span>segment_id)</span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a>        )</span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a>    }, <span class="at">.keep =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a>    bind_rows <span class="sc">%&gt;%</span></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a>    <span class="fu">left_join</span>( <span class="co"># join bike events</span></span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a>        bike_proc,</span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;street&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;segment_id&quot;</span>)</span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a>    <span class="fu">group_by</span>(street, segment_id) <span class="sc">%&gt;%</span></span>
<span id="cb6-53"><a href="#cb6-53" tabindex="-1"></a>    <span class="fu">group_map</span>(<span class="sc">~</span>{ <span class="co"># fill out types</span></span>
<span id="cb6-54"><a href="#cb6-54" tabindex="-1"></a>        .x <span class="sc">%&gt;%</span></span>
<span id="cb6-55"><a href="#cb6-55" tabindex="-1"></a>            <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb6-56"><a href="#cb6-56" tabindex="-1"></a>            <span class="fu">fill</span>(type) <span class="sc">%&gt;%</span></span>
<span id="cb6-57"><a href="#cb6-57" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">replace_na</span>(type, <span class="st">&quot;none&quot;</span>))</span>
<span id="cb6-58"><a href="#cb6-58" tabindex="-1"></a>    }, <span class="at">.keep =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-59"><a href="#cb6-59" tabindex="-1"></a>    bind_rows <span class="sc">%&gt;%</span></span>
<span id="cb6-60"><a href="#cb6-60" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb6-61"><a href="#cb6-61" tabindex="-1"></a>        bike <span class="sc">%&gt;%</span></span>
<span id="cb6-62"><a href="#cb6-62" tabindex="-1"></a>            <span class="fu">select</span>(</span>
<span id="cb6-63"><a href="#cb6-63" tabindex="-1"></a>                <span class="at">segment_id =</span> id,</span>
<span id="cb6-64"><a href="#cb6-64" tabindex="-1"></a>                <span class="at">segment_len_km =</span> geometry_len_km</span>
<span id="cb6-65"><a href="#cb6-65" tabindex="-1"></a>            ),</span>
<span id="cb6-66"><a href="#cb6-66" tabindex="-1"></a>        <span class="at">by =</span> <span class="st">&quot;segment_id&quot;</span></span>
<span id="cb6-67"><a href="#cb6-67" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-68"><a href="#cb6-68" tabindex="-1"></a>    <span class="fu">select</span>(street, year, segment_id, segment_len_km, type) <span class="sc">%&gt;%</span></span>
<span id="cb6-69"><a href="#cb6-69" tabindex="-1"></a>    <span class="fu">arrange</span>(street, year, segment_id)</span>
<span id="cb6-70"><a href="#cb6-70" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" tabindex="-1"></a><span class="co"># Show bike events</span></span>
<span id="cb6-72"><a href="#cb6-72" tabindex="-1"></a><span class="fu">datatable</span>(bike_proc)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-dd15eb8fc0d2ad5339e0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-dd15eb8fc0d2ad5339e0">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2010\" data-max=\"2022\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.13097511235632\" data-max=\"5.20281393205461\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons"],"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208"],["Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street"],[2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2010,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2011,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2014,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2015,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2016,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2017,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2018,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2019,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2020,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2021,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2022,2010,2010,2011,2011,2012,2012,2013,2013,2014,2014,2015,2015,2016,2016,2017,2017,2018,2018,2019,2019,2020,2020,2021,2021,2022,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],["1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1069","1193","1196","1204","1219","1242","1244","1249","1293","1297","1298","8","1167","514","1167","514","1167","514","1167","514","1167","514","1167","514","1167","514","1167","514","1167","514","1167","514","1167","514","1167","514","1167","514","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256"],[0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,0.4592823668461675,2.00468948639345,1.012860738985911,0.5275915359519188,0.5567976215993681,0.6176685635465278,0.3028551247785605,0.1554746489830315,2.054152450506651,0.8155355747794608,0.6144205958673269,0.3260056260085661,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,5.202813932054611,0.1309751123563201,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123],["none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","cycle track","none","none","none","none","none","none","cycle track","painted lane","none","none","none","cycle track","none","none","none","none","cycle track","none","cycle track","painted lane","none","none","none","cycle track","none","none","none","none","cycle track","none","cycle track","painted lane","none","none","none","cycle track","none","none","none","none","cycle track","none","cycle track","cycle track","none","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","cycle track","none","cycle track","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track"]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>street<\/th>\n      <th>year<\/th>\n      <th>segment_id<\/th>\n      <th>segment_len_km<\/th>\n      <th>type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":"350px","buttons":[{"extend":"csv","filename":"data","exportOptions":{"columns":":not(.rownames)"}},{"extend":"excel","filename":"data","exportOptions":{"columns":":not(.rownames)"},"title":""}],"columnDefs":[{"targets":0,"className":"rownames"},{"className":"dt-right","targets":[2,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"street","targets":1},{"name":"year","targets":2},{"name":"segment_id","targets":3},{"name":"segment_len_km","targets":4},{"name":"type","targets":5}],"dom":"Bfrtip","order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
<p>Count injured individuals for each bikeway segment by year, user, and
KSI/Non-KSI.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Count by yearly injured</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>colli_proc <span class="ot">&lt;-</span> colli_bike <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    as_tibble <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>geometry) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>        <span class="at">orig_street =</span> street,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>        <span class="at">street =</span> target_street,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>        <span class="at">segment_id =</span> bike_id</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">year</span>(colli_date)</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>    <span class="fu">group_by</span>(street, segment_id, year, user, ksi) <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    count <span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    <span class="fu">arrange</span>(street, segment_id, year, user, ksi) <span class="sc">%&gt;%</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>    ungroup</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co"># Pivot longer for colli by user and ksi</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>colli_proc <span class="ot">&lt;-</span> colli_proc <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>        <span class="at">names_from =</span> <span class="fu">c</span>(user, ksi),</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>        <span class="at">values_from =</span> n</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>    )</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co"># Display colli by seg, user, and ksi</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="fu">datatable</span>(colli_proc)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-cf5d816425a2329aa7ad" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cf5d816425a2329aa7ad">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2010\" data-max=\"2022\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"27\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"25\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"94\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"10\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons"],"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201"],["Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street"],["1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1249","1249","1249","1249","1249","1249","1249","1249","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","8","8","8","8","8","8","8","8","8","8","8","8","8","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","514","514","514","514","514","514","514","514","514","514","514","514","514","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256"],[2010,2011,2012,2013,2014,2016,2017,2018,2019,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2013,2014,2016,2017,2018,2019,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],[1,2,null,1,1,null,null,null,2,null,1,5,7,7,9,8,7,4,7,4,2,9,13,1,7,13,5,2,9,8,8,5,8,6,3,5,1,10,5,null,2,null,2,5,4,2,1,1,2,null,null,null,null,null,null,null,null,null,null,null,1,null,null,6,6,8,8,7,3,3,3,3,2,3,2,null,4,2,7,3,1,1,null,1,1,2,1,5,null,null,null,null,1,1,null,null,null,18,16,17,10,9,11,7,11,7,5,5,8,2,3,3,7,3,3,4,12,4,4,1,2,null,2,8,3,7,8,4,3,7,5,8,4,5,2,2,2,null,2,3,3,1,1,1,1,2,null,1,1,27,22,24,11,23,14,13,20,13,10,16,15,3,2,4,4,3,1,4,7,2,null,2,2,null,1,13,10,13,13,14,16,6,16,6,13,4,3,2,11,12,14,6,6,9,9,3,3,4,1,4,null],[1,null,1,null,null,2,null,null,null,null,null,7,6,9,9,4,11,8,5,8,3,6,3,1,8,10,2,2,5,5,5,6,3,3,2,null,null,2,3,2,3,4,1,3,3,4,2,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,3,2,3,3,4,2,1,3,4,null,null,1,2,2,2,null,3,3,1,3,null,1,3,null,2,null,null,null,null,null,null,null,null,null,14,13,10,11,15,10,17,3,8,1,3,2,3,1,2,3,3,6,4,2,5,2,1,1,2,null,2,4,7,5,1,3,4,5,1,1,2,1,null,null,1,null,2,null,1,null,null,null,1,null,null,null,25,20,21,18,15,17,21,17,15,7,5,10,2,2,2,null,1,1,null,3,null,null,1,2,null,null,10,8,16,11,5,11,9,10,8,6,4,3,1,10,13,6,11,13,12,11,9,9,7,1,1,2],[null,null,null,null,null,1,1,1,6,6,3,26,25,31,23,36,23,25,27,19,30,24,11,12,9,7,19,15,12,8,18,11,6,7,6,6,3,3,15,4,8,7,10,18,9,9,8,6,4,3,10,4,9,4,4,7,6,3,3,7,5,2,3,5,5,12,12,6,22,8,7,9,7,4,11,10,1,8,4,1,7,9,6,1,3,3,9,2,4,1,3,4,null,null,1,1,1,39,24,23,12,25,16,34,26,21,15,29,29,8,10,4,5,1,5,6,8,9,14,9,6,4,1,19,5,7,6,7,2,6,6,6,4,2,5,3,16,7,5,13,6,9,11,6,8,1,1,4,null,76,38,80,67,59,63,69,60,85,72,54,28,13,5,11,7,7,12,14,7,8,2,2,7,1,4,31,45,61,66,55,37,58,94,41,30,35,33,10,46,47,39,23,30,26,28,22,49,37,27,12,15],[null,null,null,null,null,null,null,null,null,2,1,1,null,1,1,1,3,2,1,1,2,2,4,6,1,3,null,null,1,3,null,2,2,null,1,1,2,null,null,1,null,null,null,1,null,null,2,null,2,2,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,2,1,null,1,2,2,3,1,null,null,null,1,null,null,null,1,null,null,1,null,null,null,null,null,null,null,null,null,null,1,2,2,3,6,3,5,2,5,3,4,2,null,null,null,null,2,3,null,null,null,1,null,null,2,null,2,3,1,null,1,1,null,null,null,2,1,1,2,null,null,2,1,null,null,null,null,null,1,null,1,4,10,10,4,3,8,5,3,5,8,9,8,10,1,null,null,null,null,1,1,2,null,null,null,null,null,4,5,7,10,2,2,2,3,null,1,4,4,1,3,4,3,2,2,2,1,1,1,2,1,1,3],[null,null,null,null,null,null,null,null,null,null,null,2,1,2,null,2,1,null,1,null,null,null,1,null,2,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,1,2,null,null,1,1,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,3,3,5,5,1,3,null,null,1,3,2,null,1,1,null,null,null,null,null,null,null,null,null,null,null,null,4,1,null,2,1,1,1,1,null,1,2,null,1,null,2,1,1,2,null,null,null,null,1,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,1,1,null,null,null,null,null,1,null,null,null,null,null,null,null,1,null,null,null,null,1,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,1,2,2,1,null,null,null,1,null,4,null,null,null,null,null,null,null,null,null,null,1,null,null,1,null,1,null,null,null,null,null,2,3,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,1,1,null,null,null,null,null,4,2,null,null,null,null,1,null,1,null,null,null,null,null,null,null,null,null,null,1,null,2,null,null,null,1,1,null,1,null,null,null,1,null,1,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,1,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,2,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,1,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,1,null,null,null,null,null,null,1,2,1,1,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,1,null,1,null,1,null,null,1,null,null,1,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,1,null,1,null,null,1,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,3,null,null,null,2,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,2,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,2,null,null,null,null,null,null,null,1,1,1,null,1,1,null,5,1,null,1,1,null,null,null,null,null,null,null,null,1,null,null,null,null,1,1,5,null,null,null,null,null,null,null,null,1,1,null,null,null,2,null,2,null,2,null,null,null,null,null]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>street<\/th>\n      <th>segment_id<\/th>\n      <th>year<\/th>\n      <th>cyclist_non_ksi<\/th>\n      <th>pedestrian_non_ksi<\/th>\n      <th>driver_non_ksi<\/th>\n      <th>other_non_ksi<\/th>\n      <th>pedestrian_ksi<\/th>\n      <th>cyclist_ksi<\/th>\n      <th>other_ksi<\/th>\n      <th>driver_ksi<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":"350px","buttons":[{"extend":"csv","filename":"data","exportOptions":{"columns":":not(.rownames)"}},{"extend":"excel","filename":"data","exportOptions":{"columns":":not(.rownames)"},"title":""}],"columnDefs":[{"targets":0,"className":"rownames"},{"className":"dt-right","targets":[3,4,5,6,7,8,9,10,11]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"street","targets":1},{"name":"segment_id","targets":2},{"name":"year","targets":3},{"name":"cyclist_non_ksi","targets":4},{"name":"pedestrian_non_ksi","targets":5},{"name":"driver_non_ksi","targets":6},{"name":"other_non_ksi","targets":7},{"name":"pedestrian_ksi","targets":8},{"name":"cyclist_ksi","targets":9},{"name":"other_ksi","targets":10},{"name":"driver_ksi","targets":11}],"dom":"Bfrtip","order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
<p>Add injured individual counts to the bikeway infrastructure type
history.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Combine bike types and colli counts</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>bike_counts <span class="ot">&lt;-</span> bike_proc <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>        colli_proc,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;street&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;segment_id&quot;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>        <span class="fu">ends_with</span>(<span class="st">&quot;ksi&quot;</span>),</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>        <span class="sc">~</span> <span class="fu">replace_na</span>(., <span class="dv">0</span>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    <span class="fu">arrange</span>(street, segment_id, year)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="fu">datatable</span>(bike_counts)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-32fb09700da1a3d805f7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-32fb09700da1a3d805f7">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2010\" data-max=\"2022\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.13097511235632\" data-max=\"5.20281393205461\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"27\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"25\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"94\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"10\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons"],"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208"],["Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street"],[2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],["1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1249","1249","1249","1249","1249","1249","1249","1249","1249","1249","1249","1249","1249","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","8","8","8","8","8","8","8","8","8","8","8","8","8","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","514","514","514","514","514","514","514","514","514","514","514","514","514","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256"],[0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123],["none","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","painted lane","painted lane","painted lane","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track"],[1,2,0,1,1,0,0,0,0,2,0,0,1,5,7,7,9,8,7,4,7,4,2,9,13,1,7,13,5,2,9,8,8,5,8,6,3,5,1,10,5,0,2,0,2,5,4,2,1,1,2,0,0,0,0,0,0,0,0,0,0,0,1,0,0,6,6,8,8,7,3,3,3,3,2,3,2,0,4,2,7,3,1,1,0,1,1,2,1,5,0,0,0,0,0,1,0,1,0,0,0,0,0,0,18,16,17,10,9,11,7,11,7,5,5,8,2,3,3,7,3,3,4,12,4,4,1,2,0,2,8,3,7,8,4,3,7,5,8,4,5,2,2,2,0,2,3,3,1,1,1,1,2,0,1,1,27,22,24,11,23,14,13,20,13,10,16,15,3,2,4,4,3,1,4,7,2,0,2,2,0,1,13,10,13,13,14,16,6,16,6,13,4,3,2,11,12,14,6,6,9,9,3,3,4,1,4,0],[1,0,1,0,0,0,2,0,0,0,0,0,0,7,6,9,9,4,11,8,5,8,3,6,3,1,8,10,2,2,5,5,5,6,3,3,2,0,0,2,3,2,3,4,1,3,3,4,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,4,2,1,3,4,0,0,1,2,2,2,0,3,3,1,3,0,1,3,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,13,10,11,15,10,17,3,8,1,3,2,3,1,2,3,3,6,4,2,5,2,1,1,2,0,2,4,7,5,1,3,4,5,1,1,2,1,0,0,1,0,2,0,1,0,0,0,1,0,0,0,25,20,21,18,15,17,21,17,15,7,5,10,2,2,2,0,1,1,0,3,0,0,1,2,0,0,10,8,16,11,5,11,9,10,8,6,4,3,1,10,13,6,11,13,12,11,9,9,7,1,1,2],[0,0,0,0,0,0,1,1,1,6,0,6,3,26,25,31,23,36,23,25,27,19,30,24,11,12,9,7,19,15,12,8,18,11,6,7,6,6,3,3,15,4,8,7,10,18,9,9,8,6,4,3,10,4,9,4,4,7,6,3,3,7,5,2,3,5,5,12,12,6,22,8,7,9,7,4,11,10,1,8,4,1,7,9,6,1,3,3,9,2,4,1,3,0,4,0,0,0,1,1,1,0,0,0,39,24,23,12,25,16,34,26,21,15,29,29,8,10,4,5,1,5,6,8,9,14,9,6,4,1,19,5,7,6,7,2,6,6,6,4,2,5,3,16,7,5,13,6,9,11,6,8,1,1,4,0,76,38,80,67,59,63,69,60,85,72,54,28,13,5,11,7,7,12,14,7,8,2,2,7,1,4,31,45,61,66,55,37,58,94,41,30,35,33,10,46,47,39,23,30,26,28,22,49,37,27,12,15],[0,0,0,0,0,0,0,0,0,0,0,2,1,1,0,1,1,1,3,2,1,1,2,2,4,6,1,3,0,0,1,3,0,2,2,0,1,1,2,0,0,1,0,0,0,1,0,0,2,0,2,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,1,0,1,2,2,3,1,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,3,6,3,5,2,5,3,4,2,0,0,0,0,2,3,0,0,0,1,0,0,2,0,2,3,1,0,1,1,0,0,0,2,1,1,2,0,0,2,1,0,0,0,0,0,1,0,1,4,10,10,4,3,8,5,3,5,8,9,8,10,1,0,0,0,0,1,1,2,0,0,0,0,0,4,5,7,10,2,2,2,3,0,1,4,4,1,3,4,3,2,2,2,1,1,1,2,1,1,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,2,1,0,1,0,0,0,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,5,1,3,0,0,1,3,2,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,4,1,0,2,1,1,1,1,0,1,2,0,1,0,2,1,1,2,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,2,2,1,0,0,0,1,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0,0,2,3,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,4,2,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,2,0,0,0,1,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,2,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,2,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,1,1,0,1,1,0,5,1,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,5,0,0,0,0,0,0,0,0,1,1,0,0,0,2,0,2,0,2,0,0,0,0,0]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>street<\/th>\n      <th>year<\/th>\n      <th>segment_id<\/th>\n      <th>segment_len_km<\/th>\n      <th>type<\/th>\n      <th>cyclist_non_ksi<\/th>\n      <th>pedestrian_non_ksi<\/th>\n      <th>driver_non_ksi<\/th>\n      <th>other_non_ksi<\/th>\n      <th>pedestrian_ksi<\/th>\n      <th>cyclist_ksi<\/th>\n      <th>other_ksi<\/th>\n      <th>driver_ksi<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":"350px","buttons":[{"extend":"csv","filename":"data","exportOptions":{"columns":":not(.rownames)"}},{"extend":"excel","filename":"data","exportOptions":{"columns":":not(.rownames)"},"title":""}],"columnDefs":[{"targets":0,"className":"rownames"},{"className":"dt-right","targets":[2,4,6,7,8,9,10,11,12,13]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"street","targets":1},{"name":"year","targets":2},{"name":"segment_id","targets":3},{"name":"segment_len_km","targets":4},{"name":"type","targets":5},{"name":"cyclist_non_ksi","targets":6},{"name":"pedestrian_non_ksi","targets":7},{"name":"driver_non_ksi","targets":8},{"name":"other_non_ksi","targets":9},{"name":"pedestrian_ksi","targets":10},{"name":"cyclist_ksi","targets":11},{"name":"other_ksi","targets":12},{"name":"driver_ksi","targets":13}],"dom":"Bfrtip","order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="results" class="section level1 tabset">
<h1 class="tabset">Results</h1>
<p>The results contain:</p>
<ol style="list-style-type: decimal">
<li>Data of injury counts and rates by infrastructure type and year</li>
<li>Plot showing injury counts by street and road user</li>
</ol>
<div id="data-1" class="section level2 tabset tabset-dropdown">
<h2 class="tabset tabset-dropdown">Data</h2>
<p>The resulting data consists of injury counts on verified bikeways by
segments and by segment quarters.</p>
<p><strong>Note: Use the dropdown to view different sets of
data.</strong></p>
<div id="by-segments" class="section level3">
<h3>By Segments</h3>
<p>The resulting data consists of the following columns:</p>
<ul>
<li><code>year</code> the year of the collisions</li>
<li><code>street</code>: the street of interest</li>
<li><code>type</code>: the type of infrastructure</li>
<li><code>segment_id</code>: the segment identifier</li>
<li><code>ksi</code>: the total number of Killed or Seriously Injured
(KSI) collisions</li>
<li><code>non_ksi</code>: the total number of non-KSI collisions</li>
<li><code>&lt;USER&gt;_ksi</code>: the number of KSI individuals for a
road user group indicated by <code>&lt;USER&gt;</code></li>
<li><code>&lt;USER&gt;_non_ksi</code>: the number of non-KSI individuals
for a road user group indicated by <code>&lt;USER&gt;</code></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Create output data</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>out <span class="ot">&lt;-</span> bike_counts <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="co"># calc total ksi</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>        <span class="at">ksi =</span> <span class="fu">select</span>(., <span class="sc">!</span><span class="fu">ends_with</span> (<span class="st">&quot;_non_ksi&quot;</span>) <span class="sc">&amp;</span> <span class="fu">ends_with</span>(<span class="st">&quot;_ksi&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>            <span class="fu">rowSums</span>(<span class="at">na.rm =</span> T),</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>        <span class="at">non_ksi =</span> <span class="fu">select</span>(., <span class="fu">ends_with</span>(<span class="st">&quot;_non_ksi&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>            <span class="fu">rowSums</span>(<span class="at">na.rm =</span> T)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">order</span>(<span class="fu">colnames</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>        year,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>        street,</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>        type,</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>        segment_id,</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>        segment_len_km,</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>        ksi,</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>        non_ksi,</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>        <span class="fu">ends_with</span>(<span class="st">&quot;_ksi&quot;</span>),</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>        <span class="fu">everything</span>()</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>    )</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co"># Show data table</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>    out,</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">glue</span>(<span class="st">&quot;toronto-collisions-bloorunidanyonge-{today()}&quot;</span>)</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5e25e158b10b1af5d93a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5e25e158b10b1af5d93a">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2010\" data-max=\"2022\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.13097511235632\" data-max=\"5.20281393205461\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"9\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"135\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"27\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"94\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"10\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"25\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons"],"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208"],[2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022],["Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Bloor Street","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","University Avenue","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street","Yonge Street"],["none","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","painted lane","painted lane","painted lane","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track","cycle track","none","none","none","none","none","none","none","none","none","none","none","cycle track","cycle track"],["1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1069","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1193","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1196","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1204","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1219","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1242","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1244","1249","1249","1249","1249","1249","1249","1249","1249","1249","1249","1249","1249","1249","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1293","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1297","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","1298","8","8","8","8","8","8","8","8","8","8","8","8","8","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","1167","514","514","514","514","514","514","514","514","514","514","514","514","514","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1172","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256","1256"],[0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,0.4592823668461675,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,2.00468948639345,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,1.012860738985911,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5275915359519188,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.5567976215993681,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.6176685635465278,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.3028551247785605,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,0.1554746489830315,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,2.054152450506651,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.8155355747794608,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.6144205958673269,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,0.3260056260085661,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,5.202813932054611,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,0.1309751123563201,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.176251582941203,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123,3.377973559992123],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,0,3,2,0,2,2,1,1,2,0,2,0,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,3,0,0,0,2,0,0,0,2,0,0,2,0,0,0,0,0,1,0,0,0,0,0,0,1,3,2,3,2,1,0,0,3,1,4,0,0,0,0,0,0,0,0,0,0,3,0,1,1,0,2,0,0,1,1,0,2,3,0,0,0,0,0,0,0,0,0,1,0,2,0,0,0,0,0,0,5,6,6,6,1,4,1,4,9,6,3,2,2,2,0,1,1,0,0,0,0,1,0,0,0,0,6,2,7,2,1,1,3,3,0,3,2,2,2,1,3,2,3,3,2,0,2,0,1,0,0,0],[2,2,1,1,1,0,3,1,1,8,0,8,5,39,38,48,42,49,44,39,40,32,37,41,31,20,25,33,26,19,27,24,31,24,19,16,12,12,6,15,23,7,13,11,13,27,16,15,13,8,8,5,10,4,9,4,4,7,6,3,3,7,7,2,3,14,13,23,23,17,27,14,14,16,10,9,16,15,8,12,11,7,12,11,9,2,6,8,10,10,4,1,3,0,4,1,0,1,1,1,1,0,0,0,71,54,52,35,52,43,61,45,38,26,40,43,15,14,9,15,7,16,17,22,18,20,12,9,6,5,29,14,24,20,12,9,18,16,15,9,11,9,6,20,8,7,20,10,11,12,7,9,4,2,5,2,132,90,135,100,100,102,108,100,118,97,84,61,28,10,17,11,11,14,19,18,12,2,5,11,1,5,58,68,97,100,76,66,75,123,55,50,47,43,14,70,76,62,42,51,49,49,35,62,50,30,18,20],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,2,2,1,0,0,0,1,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,0,0,2,3,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,4,2,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,2,0,0,0,1,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[1,2,0,1,1,0,0,0,0,2,0,0,1,5,7,7,9,8,7,4,7,4,2,9,13,1,7,13,5,2,9,8,8,5,8,6,3,5,1,10,5,0,2,0,2,5,4,2,1,1,2,0,0,0,0,0,0,0,0,0,0,0,1,0,0,6,6,8,8,7,3,3,3,3,2,3,2,0,4,2,7,3,1,1,0,1,1,2,1,5,0,0,0,0,0,1,0,1,0,0,0,0,0,0,18,16,17,10,9,11,7,11,7,5,5,8,2,3,3,7,3,3,4,12,4,4,1,2,0,2,8,3,7,8,4,3,7,5,8,4,5,2,2,2,0,2,3,3,1,1,1,1,2,0,1,1,27,22,24,11,23,14,13,20,13,10,16,15,3,2,4,4,3,1,4,7,2,0,2,2,0,1,13,10,13,13,14,16,6,16,6,13,4,3,2,11,12,14,6,6,9,9,3,3,4,1,4,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,2,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,1,1,0,1,1,0,5,1,0,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,5,0,0,0,0,0,0,0,0,1,1,0,0,0,2,0,2,0,2,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,6,0,6,3,26,25,31,23,36,23,25,27,19,30,24,11,12,9,7,19,15,12,8,18,11,6,7,6,6,3,3,15,4,8,7,10,18,9,9,8,6,4,3,10,4,9,4,4,7,6,3,3,7,5,2,3,5,5,12,12,6,22,8,7,9,7,4,11,10,1,8,4,1,7,9,6,1,3,3,9,2,4,1,3,0,4,0,0,0,1,1,1,0,0,0,39,24,23,12,25,16,34,26,21,15,29,29,8,10,4,5,1,5,6,8,9,14,9,6,4,1,19,5,7,6,7,2,6,6,6,4,2,5,3,16,7,5,13,6,9,11,6,8,1,1,4,0,76,38,80,67,59,63,69,60,85,72,54,28,13,5,11,7,7,12,14,7,8,2,2,7,1,4,31,45,61,66,55,37,58,94,41,30,35,33,10,46,47,39,23,30,26,28,22,49,37,27,12,15],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,2,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,1,1,0,1,1,1,3,2,1,1,2,2,4,6,1,3,0,0,1,3,0,2,2,0,1,1,2,0,0,1,0,0,0,1,0,0,2,0,2,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,1,0,1,2,2,3,1,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,3,6,3,5,2,5,3,4,2,0,0,0,0,2,3,0,0,0,1,0,0,2,0,2,3,1,0,1,1,0,0,0,2,1,1,2,0,0,2,1,0,0,0,0,0,1,0,1,4,10,10,4,3,8,5,3,5,8,9,8,10,1,0,0,0,0,1,1,2,0,0,0,0,0,4,5,7,10,2,2,2,3,0,1,4,4,1,3,4,3,2,2,2,1,1,1,2,1,1,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,2,1,0,1,0,0,0,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,5,1,3,0,0,1,3,2,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,4,1,0,2,1,1,1,1,0,1,2,0,1,0,2,1,1,2,0,0,0,0,1,0,0,0],[1,0,1,0,0,0,2,0,0,0,0,0,0,7,6,9,9,4,11,8,5,8,3,6,3,1,8,10,2,2,5,5,5,6,3,3,2,0,0,2,3,2,3,4,1,3,3,4,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,4,2,1,3,4,0,0,1,2,2,2,0,3,3,1,3,0,1,3,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,13,10,11,15,10,17,3,8,1,3,2,3,1,2,3,3,6,4,2,5,2,1,1,2,0,2,4,7,5,1,3,4,5,1,1,2,1,0,0,1,0,2,0,1,0,0,0,1,0,0,0,25,20,21,18,15,17,21,17,15,7,5,10,2,2,2,0,1,1,0,3,0,0,1,2,0,0,10,8,16,11,5,11,9,10,8,6,4,3,1,10,13,6,11,13,12,11,9,9,7,1,1,2]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>street<\/th>\n      <th>type<\/th>\n      <th>segment_id<\/th>\n      <th>segment_len_km<\/th>\n      <th>ksi<\/th>\n      <th>non_ksi<\/th>\n      <th>cyclist_ksi<\/th>\n      <th>cyclist_non_ksi<\/th>\n      <th>driver_ksi<\/th>\n      <th>driver_non_ksi<\/th>\n      <th>other_ksi<\/th>\n      <th>other_non_ksi<\/th>\n      <th>pedestrian_ksi<\/th>\n      <th>pedestrian_non_ksi<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":"350px","buttons":[{"extend":"csv","filename":"toronto-collisions-bloorunidanyonge-2024-12-16","exportOptions":{"columns":":not(.rownames)"}},{"extend":"excel","filename":"toronto-collisions-bloorunidanyonge-2024-12-16","exportOptions":{"columns":":not(.rownames)"},"title":""}],"columnDefs":[{"targets":0,"className":"rownames"},{"className":"dt-right","targets":[1,5,6,7,8,9,10,11,12,13,14,15]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"year","targets":1},{"name":"street","targets":2},{"name":"type","targets":3},{"name":"segment_id","targets":4},{"name":"segment_len_km","targets":5},{"name":"ksi","targets":6},{"name":"non_ksi","targets":7},{"name":"cyclist_ksi","targets":8},{"name":"cyclist_non_ksi","targets":9},{"name":"driver_ksi","targets":10},{"name":"driver_non_ksi","targets":11},{"name":"other_ksi","targets":12},{"name":"other_non_ksi","targets":13},{"name":"pedestrian_ksi","targets":14},{"name":"pedestrian_non_ksi","targets":15}],"dom":"Bfrtip","order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="by-kilometers" class="section level3">
<h3>By Kilometers</h3>
<p>The rates data consists of injured individuals per km-year for each
street and infrastructure type:</p>
<ul>
<li><code>street</code>: the street of interest</li>
<li><code>type</code>: the type of infrastructure</li>
<li><code>segments</code>: the number of segments for the infrastructure
type</li>
<li><code>mean_segments_per_year</code>: the average number of segments
per year for the infrastructure year</li>
<li><code>ksi</code>: the total number of Killed or Seriously Injured
(KSI) collisions</li>
<li><code>non_ksi</code>: the total number of non-KSI collisions</li>
<li><code>&lt;USER&gt;_ksi</code>: the number of KSI individuals for a
road user group indicated by <code>&lt;USER&gt;</code></li>
<li><code>&lt;USER&gt;_non_ksi</code>: the number of non-KSI individuals
for a road user group indicated by <code>&lt;USER&gt;</code></li>
<li><code>&lt;USER&gt;_ksi_per_km</code>: the number of KSI individuals
for a road user group indicated by <code>&lt;USER&gt;</code> per
km-year</li>
<li><code>&lt;USER&gt;_non_ksi_per_km</code>: the number of non-KSI
individuals for a road user group indicated by <code>&lt;USER&gt;</code>
per km-year</li>
</ul>
<p>Injury rates per segment-year for a street and infrastructure type
are calculated using the following equation:</p>
<p><span class="math display">\[
Rate_{street,type} = \frac{\sum_{i=1}^{n}\sum_{j=1}^{m}x_{i,j}}{l_{i,j}}
\]</span></p>
<ul>
<li><span class="math inline">\(Rate_{street,type}\)</span> is the
number of injuries per km-year for a street and infrastructure type</li>
<li><span class="math inline">\(n\)</span> is the number of years in the
collision data</li>
<li><span class="math inline">\(i\)</span> is the year index of the
collision data range (e.g. <span class="math inline">\(i=1\)</span> is
the first year)</li>
<li><span class="math inline">\(m\)</span> is the number of segments in
the collision data</li>
<li><span class="math inline">\(j\)</span> is the segment index of the
collision data range (e.g. <span class="math inline">\(j=1\)</span> is
the first segment)</li>
<li><span class="math inline">\(x_{i,j}\)</span> is the number of
injuries for year <span class="math inline">\(i\)</span> and segment
<span class="math inline">\(j\)</span> for the given street and
infrastructure type</li>
<li><span class="math inline">\(l_{i,j}\)</span> is the length of
segment <span class="math inline">\(i\)</span> for year <span
class="math inline">\(j\)</span> for the given street and infrastructure
type</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Calc rates for output</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>out_rates <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    <span class="at">street =</span> <span class="fu">unique</span>(out<span class="sc">$</span>street),</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;none&quot;</span>, <span class="st">&quot;painted lane&quot;</span>, <span class="st">&quot;cycle track&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>        out <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>            <span class="fu">group_by</span>(street, year, type) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>            <span class="fu">summarize</span>( <span class="co"># yearly calcs</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>                <span class="at">segments =</span> <span class="fu">n</span>(),</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>                <span class="at">len_km =</span> <span class="fu">sum</span>(segment_len_km, <span class="at">na.rm =</span> T),</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>                <span class="fu">across</span>(</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>                    <span class="fu">starts_with</span>(<span class="st">&quot;ksi&quot;</span>) <span class="sc">|</span> <span class="fu">ends_with</span>(<span class="st">&quot;_ksi&quot;</span>),</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>                    <span class="sc">~</span> <span class="fu">sum</span>(., <span class="at">na.rm =</span> T)</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>                ),</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>                <span class="fu">across</span>(</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>                    <span class="fu">starts_with</span>(<span class="st">&quot;ksi&quot;</span>) <span class="sc">|</span> <span class="fu">ends_with</span>(<span class="st">&quot;_ksi&quot;</span>),</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>                    <span class="sc">~</span> . <span class="sc">/</span> len_km,</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>                    <span class="at">.names =</span> <span class="st">&quot;{.col}_per_km&quot;</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>                )</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>            <span class="fu">group_by</span>(street, type) <span class="sc">%&gt;%</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>            <span class="fu">summarize</span>( <span class="co"># total calcs</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>                <span class="at">mean_segments_per_year =</span> <span class="fu">mean</span>(segments, <span class="at">na.rm =</span> T),</span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>                <span class="at">segments =</span> <span class="fu">sum</span>(segments, <span class="at">na.rm =</span> T),</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>                <span class="at">len_km =</span> <span class="fu">sum</span>(len_km, <span class="at">na.rm =</span> T),</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>                <span class="fu">across</span>(</span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>                    <span class="fu">starts_with</span>(<span class="st">&quot;ksi&quot;</span>) <span class="sc">|</span> <span class="fu">ends_with</span>(<span class="st">&quot;_ksi&quot;</span>),</span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>                    <span class="sc">~</span> <span class="fu">sum</span>(., <span class="at">na.rm =</span> T)</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>                ),</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>                <span class="fu">across</span>(</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a>                    <span class="fu">starts_with</span>(<span class="st">&quot;ksi&quot;</span>) <span class="sc">|</span> <span class="fu">ends_with</span>(<span class="st">&quot;_ksi&quot;</span>),</span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>                    <span class="sc">~</span> . <span class="sc">/</span> len_km,</span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a>                    <span class="at">.names =</span> <span class="st">&quot;{.col}_per_km&quot;</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>                )</span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>            ),</span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;street&quot;</span>, <span class="st">&quot;type&quot;</span>)</span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">order</span>(<span class="fu">colnames</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>        street,</span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>        type,</span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>        segments,</span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a>        mean_segments_per_year,</span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>        len_km,</span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>        <span class="fu">starts_with</span>(<span class="st">&quot;ksi&quot;</span>),</span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a>        <span class="fu">starts_with</span>(<span class="st">&quot;non_ksi&quot;</span>),</span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a>        <span class="fu">everything</span>()</span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a>        <span class="at">type =</span> <span class="fu">factor</span>(</span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a>            type,</span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a>            <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a>                <span class="st">&quot;none&quot;</span>,</span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a>                <span class="st">&quot;painted lane&quot;</span>,</span>
<span id="cb10-56"><a href="#cb10-56" tabindex="-1"></a>                <span class="st">&quot;cycle track&quot;</span></span>
<span id="cb10-57"><a href="#cb10-57" tabindex="-1"></a>            )</span>
<span id="cb10-58"><a href="#cb10-58" tabindex="-1"></a>        )</span>
<span id="cb10-59"><a href="#cb10-59" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb10-60"><a href="#cb10-60" tabindex="-1"></a>    <span class="fu">arrange</span>(street, type)</span>
<span id="cb10-61"><a href="#cb10-61" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" tabindex="-1"></a><span class="co"># Show data table</span></span>
<span id="cb10-63"><a href="#cb10-63" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb10-64"><a href="#cb10-64" tabindex="-1"></a>    out_rates,</span>
<span id="cb10-65"><a href="#cb10-65" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">glue</span>(<span class="st">&quot;toronto-collisions-bloorunidanyonge-rates-{today()}&quot;</span>)</span>
<span id="cb10-66"><a href="#cb10-66" tabindex="-1"></a>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-70c52158db128d0fdbc5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-70c52158db128d0fdbc5">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;none&quot;,&quot;painted lane&quot;,&quot;cycle track&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"107\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"9.72727272727273\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1.84326178760198\" data-max=\"85.0209397498443\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"58\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2.71258268013293\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"4.4148628779343\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"38\" data-max=\"1832\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"5.62467398354779\" data-max=\"26.5833102653027\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"17\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2.71258268013293\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"4\" data-max=\"398\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.592070945636609\" data-max=\"10.8503307205317\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"0.220385565098028\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"18\" data-max=\"1031\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"3.99647888304711\" data-max=\"16.308531817254\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"6\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"0.121993675763868\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"79\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.542516536026586\" data-max=\"1.76890829857607\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"25\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"0.472188430938746\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"3\" data-max=\"324\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.444053209227457\" data-max=\"5.42516536026586\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons"],"fillContainer":true,"data":[["1","2","3","4","5","6","7","8","9","10","11","12"],["Bloor Street","Bloor Street","Bloor Street","Danforth Street/Avenue","Danforth Street/Avenue","Danforth Street/Avenue","University Avenue","University Avenue","University Avenue","Yonge Street","Yonge Street","Yonge Street"],["none","painted lane","cycle track","none","painted lane","cycle track","none","painted lane","cycle track","none","painted lane","cycle track"],[107,3,46,17,null,9,10,null,3,11,null,2],[9.727272727272727,1,6.571428571428571,1.7,null,1.5,1,null,1,1,null,1],[85.02093974984426,1.843261787601981,35.951144807764,52.94496510704035,null,16.39429247030175,31.76251582941202,null,9.528754748823609,37.15770915991335,null,6.755947119984246],[58,5,15,52,null,8,28,null,6,17,null,0],[0.6821848849313177,2.712582680132932,0.4172328886940092,0.9821519363525901,null,0.4879747030554684,0.8815422603921084,null,0.6296730431372202,0.4575093670828345,null,0],[0.08004784763122737,4.414862877934296,0.07979608120900977,0.1858314819417372,null,0.5457647034385241,0.2775416988775813,null,0.1982440706268438,0.1354390018031702,null,0],[1832,49,557,1182,null,209,768,null,104,576,null,38],[21.54763291714093,26.58331026530274,15.49324793350421,22.32506901478387,null,12.74833911732411,24.17944485646926,null,10.91433274771182,15.50149384939486,null,5.624673983547789],[17,5,7,10,null,0,6,null,0,2,null,0],[0.1999507421350414,2.712582680132932,0.1947086813905376,0.1888753723754981,null,0,0.1889019129411661,null,0,0.05382463142150994,null,0],[398,20,130,202,null,41,120,null,9,78,null,4],[4.681199727632145,10.85033072053173,3.616018368681412,3.815282521985062,null,2.500870353159276,3.778038258823322,null,0.9445095647058304,2.099160625438888,null,0.5920709456366093],[13,0,4,11,null,3,7,null,2,6,null,0],[0.1529035086915022,0,0.1112621036517358,0.2077629096130479,null,0.1829905136458007,0.2203855650980271,null,0.2098910143790734,0.1614738942645298,null,0],[1031,18,314,732,null,119,518,null,78,374,null,27],[12.12642442007222,9.765297648478557,8.734075136661259,13.82567725788646,null,7.258623707950093,16.30853181725401,null,8.185749560783863,10.06520607582236,null,3.996478883047113],[6,0,3,6,null,2,3,null,1,2,null,0],[0.07057085016530873,0,0.08344657773880183,0.1133252234252989,null,0.1219936757638671,0.09445095647058305,null,0.1049455071895367,0.05382463142150994,null,0],[79,1,53,63,null,29,36,null,9,22,null,4],[0.9291828605098982,0.5425165360265864,1.474222873385499,1.189914845965638,null,1.768908298576073,1.133411477646997,null,0.9445095647058304,0.5920709456366093,null,0.5920709456366093],[22,0,1,25,null,3,12,null,3,7,null,0],[0.2587597839394653,0,0.02781552591293394,0.4721884309387452,null,0.1829905136458007,0.3778038258823322,null,0.3148365215686101,0.1883862099752848,null,0],[324,10,60,185,null,20,94,null,8,102,null,3],[3.810825908926671,5.425165360265864,1.668931554776037,3.494194388946715,null,1.219936757638671,2.959463302744935,null,0.8395640575162936,2.745056202497007,null,0.444053209227457]],"container":"<table class=\"display fill-container\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>street<\/th>\n      <th>type<\/th>\n      <th>segments<\/th>\n      <th>mean_segments_per_year<\/th>\n      <th>len_km<\/th>\n      <th>ksi<\/th>\n      <th>ksi_per_km<\/th>\n      <th>ksi_per_km_per_km<\/th>\n      <th>non_ksi<\/th>\n      <th>non_ksi_per_km<\/th>\n      <th>cyclist_ksi<\/th>\n      <th>cyclist_ksi_per_km<\/th>\n      <th>cyclist_non_ksi<\/th>\n      <th>cyclist_non_ksi_per_km<\/th>\n      <th>driver_ksi<\/th>\n      <th>driver_ksi_per_km<\/th>\n      <th>driver_non_ksi<\/th>\n      <th>driver_non_ksi_per_km<\/th>\n      <th>other_ksi<\/th>\n      <th>other_ksi_per_km<\/th>\n      <th>other_non_ksi<\/th>\n      <th>other_non_ksi_per_km<\/th>\n      <th>pedestrian_ksi<\/th>\n      <th>pedestrian_ksi_per_km<\/th>\n      <th>pedestrian_non_ksi<\/th>\n      <th>pedestrian_non_ksi_per_km<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":"350px","buttons":[{"extend":"csv","filename":"toronto-collisions-bloorunidanyonge-rates-2024-12-16","exportOptions":{"columns":":not(.rownames)"}},{"extend":"excel","filename":"toronto-collisions-bloorunidanyonge-rates-2024-12-16","exportOptions":{"columns":":not(.rownames)"},"title":""}],"columnDefs":[{"targets":0,"className":"rownames"},{"className":"dt-right","targets":[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"street","targets":1},{"name":"type","targets":2},{"name":"segments","targets":3},{"name":"mean_segments_per_year","targets":4},{"name":"len_km","targets":5},{"name":"ksi","targets":6},{"name":"ksi_per_km","targets":7},{"name":"ksi_per_km_per_km","targets":8},{"name":"non_ksi","targets":9},{"name":"non_ksi_per_km","targets":10},{"name":"cyclist_ksi","targets":11},{"name":"cyclist_ksi_per_km","targets":12},{"name":"cyclist_non_ksi","targets":13},{"name":"cyclist_non_ksi_per_km","targets":14},{"name":"driver_ksi","targets":15},{"name":"driver_ksi_per_km","targets":16},{"name":"driver_non_ksi","targets":17},{"name":"driver_non_ksi_per_km","targets":18},{"name":"other_ksi","targets":19},{"name":"other_ksi_per_km","targets":20},{"name":"other_non_ksi","targets":21},{"name":"other_non_ksi_per_km","targets":22},{"name":"pedestrian_ksi","targets":23},{"name":"pedestrian_ksi_per_km","targets":24},{"name":"pedestrian_non_ksi","targets":25},{"name":"pedestrian_non_ksi_per_km","targets":26}],"dom":"Bfrtip","order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="plots" class="section level2 tabset tabset-dropdown">
<h2 class="tabset tabset-dropdown">Plots</h2>
<p>These plots show the number of KSI collisions by road user for cycle
tracks on Bloor Street, Danforth Street/Avenue, University Avenue, and
Yonge Street.</p>
<p>Vertical dotted lines show added cycling infrastructure that was
completed for by that year, where CT is Cycle Tracks added and PL is
Painted Lanes added.</p>
<p><strong>Note: Use the dropdown to view different plots by street and
road user.</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Prep plot data</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> colli_bike <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    as_tibble <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>geometry) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">year</span>(colli_date),</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>        <span class="at">quarter =</span> <span class="fu">quarter</span>(colli_date),</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>        <span class="at">user =</span> <span class="fu">str_to_title</span>(user)</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>    <span class="fu">filter</span>(user <span class="sc">!=</span> <span class="st">&quot;Other&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>        <span class="at">street_orig =</span> street,</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>        <span class="at">street =</span> target_street</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    <span class="fu">group_by</span>(street, year, quarter, user) <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    count <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>        <span class="at">quarter_date =</span> <span class="fu">as_date</span>(<span class="fu">glue</span>(<span class="st">&quot;{year}-{quarter * 3}-01&quot;</span>))</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>    )</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co"># Calc bike events</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>bike_events <span class="ot">&lt;-</span> bike <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>            verify_install_type,</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>            verify_upgrade1_type,</span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>            verify_upgrade2_type</span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>        ),</span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">&quot;type_column&quot;</span>,</span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">&quot;type&quot;</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(type)) <span class="sc">%&gt;%</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a>            type_column <span class="sc">==</span> <span class="st">&quot;verify_install_type&quot;</span> <span class="sc">~</span> verify_install_year,</span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>            type_column <span class="sc">==</span> <span class="st">&quot;verify_upgrade1_type&quot;</span> <span class="sc">~</span> verify_upgrade1_year,</span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a>            type_column <span class="sc">==</span> <span class="st">&quot;verify_upgrade2_type&quot;</span> <span class="sc">~</span> verify_upgrade2_year</span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a>        ),</span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a>        <span class="at">len_km =</span> <span class="fu">as.numeric</span>(<span class="fu">st_length</span>(geometry)) <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a>        <span class="at">street_orig =</span> street,</span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a>        <span class="at">street =</span> target_street</span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a>        street,</span>
<span id="cb11-47"><a href="#cb11-47" tabindex="-1"></a>        year,</span>
<span id="cb11-48"><a href="#cb11-48" tabindex="-1"></a>        type,</span>
<span id="cb11-49"><a href="#cb11-49" tabindex="-1"></a>        len_km</span>
<span id="cb11-50"><a href="#cb11-50" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-51"><a href="#cb11-51" tabindex="-1"></a>    as_tibble <span class="sc">%&gt;%</span></span>
<span id="cb11-52"><a href="#cb11-52" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>geometry) <span class="sc">%&gt;%</span></span>
<span id="cb11-53"><a href="#cb11-53" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb11-54"><a href="#cb11-54" tabindex="-1"></a>    <span class="fu">group_by</span>(street, year, type) <span class="sc">%&gt;%</span></span>
<span id="cb11-55"><a href="#cb11-55" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">len_km =</span> <span class="fu">sum</span>(len_km, <span class="at">na.rm =</span> T))</span>
<span id="cb11-56"><a href="#cb11-56" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" tabindex="-1"></a><span class="co"># Calc cumulative bike infra lens</span></span>
<span id="cb11-58"><a href="#cb11-58" tabindex="-1"></a>min_year <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">year</span>(colli_bike<span class="sc">$</span>colli_date), <span class="at">na.rm =</span> T)</span>
<span id="cb11-59"><a href="#cb11-59" tabindex="-1"></a>max_year <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">year</span>(colli_bike<span class="sc">$</span>colli_date), <span class="at">na.rm =</span> T)</span>
<span id="cb11-60"><a href="#cb11-60" tabindex="-1"></a>bike_events <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb11-61"><a href="#cb11-61" tabindex="-1"></a>    <span class="at">year =</span> min_year<span class="sc">:</span>max_year,</span>
<span id="cb11-62"><a href="#cb11-62" tabindex="-1"></a>    <span class="at">street =</span> <span class="fu">unique</span>(bike_events<span class="sc">$</span>street),</span>
<span id="cb11-63"><a href="#cb11-63" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">unique</span>(bike_events<span class="sc">$</span>type)</span>
<span id="cb11-64"><a href="#cb11-64" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb11-65"><a href="#cb11-65" tabindex="-1"></a>    <span class="fu">filter</span>(type <span class="sc">!=</span> <span class="st">&quot;none&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-66"><a href="#cb11-66" tabindex="-1"></a>    <span class="fu">left_join</span>(bike_events, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;street&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;type&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-67"><a href="#cb11-67" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">clen_km =</span> <span class="fu">replace_na</span>(len_km, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-68"><a href="#cb11-68" tabindex="-1"></a>    <span class="fu">arrange</span>(type, street, year) <span class="sc">%&gt;%</span></span>
<span id="cb11-69"><a href="#cb11-69" tabindex="-1"></a>    <span class="fu">group_by</span>(street, type) <span class="sc">%&gt;%</span></span>
<span id="cb11-70"><a href="#cb11-70" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">clen_km =</span> <span class="fu">cumsum</span>(clen_km)) <span class="sc">%&gt;%</span></span>
<span id="cb11-71"><a href="#cb11-71" tabindex="-1"></a>    ungroup</span>
<span id="cb11-72"><a href="#cb11-72" tabindex="-1"></a></span>
<span id="cb11-73"><a href="#cb11-73" tabindex="-1"></a><span class="co"># Pivot bike events wider to have types in own cols</span></span>
<span id="cb11-74"><a href="#cb11-74" tabindex="-1"></a>bike_events <span class="ot">&lt;-</span> bike_events <span class="sc">%&gt;%</span></span>
<span id="cb11-75"><a href="#cb11-75" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-76"><a href="#cb11-76" tabindex="-1"></a>        <span class="at">event_year =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(len_km), year, <span class="cn">NA</span>),</span>
<span id="cb11-77"><a href="#cb11-77" tabindex="-1"></a>        <span class="at">event_date =</span> <span class="fu">if_else</span>(</span>
<span id="cb11-78"><a href="#cb11-78" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(event_year),</span>
<span id="cb11-79"><a href="#cb11-79" tabindex="-1"></a>            <span class="fu">as_date</span>(<span class="fu">glue</span>(<span class="st">&quot;{year}-01-01&quot;</span>)),</span>
<span id="cb11-80"><a href="#cb11-80" tabindex="-1"></a>            <span class="cn">NA</span></span>
<span id="cb11-81"><a href="#cb11-81" tabindex="-1"></a>        )</span>
<span id="cb11-82"><a href="#cb11-82" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-83"><a href="#cb11-83" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(</span>
<span id="cb11-84"><a href="#cb11-84" tabindex="-1"></a>        <span class="at">names_from =</span> type,</span>
<span id="cb11-85"><a href="#cb11-85" tabindex="-1"></a>        <span class="at">names_glue =</span> <span class="st">&quot;{str_replace_all(type, &#39; &#39;, &#39;_&#39;)}_{str_replace(.value, &#39;event_&#39;, &#39;&#39;)}&quot;</span>,</span>
<span id="cb11-86"><a href="#cb11-86" tabindex="-1"></a>        <span class="at">values_from =</span> <span class="fu">c</span>(event_year, event_date, len_km, clen_km)</span>
<span id="cb11-87"><a href="#cb11-87" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-88"><a href="#cb11-88" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-89"><a href="#cb11-89" tabindex="-1"></a>        <span class="at">type_label =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-90"><a href="#cb11-90" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(painted_lane_len_km) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(cycle_track_len_km)</span>
<span id="cb11-91"><a href="#cb11-91" tabindex="-1"></a>                <span class="sc">~</span> <span class="fu">glue</span>(</span>
<span id="cb11-92"><a href="#cb11-92" tabindex="-1"></a>                    <span class="st">&quot;PL: +{round(painted_lane_len_km, 1)} km</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb11-93"><a href="#cb11-93" tabindex="-1"></a>                    <span class="st">&quot;CT: +{round(cycle_track_len_km, 1)} km&quot;</span></span>
<span id="cb11-94"><a href="#cb11-94" tabindex="-1"></a>                ),</span>
<span id="cb11-95"><a href="#cb11-95" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(painted_lane_len_km)</span>
<span id="cb11-96"><a href="#cb11-96" tabindex="-1"></a>                <span class="sc">~</span> <span class="fu">glue</span>(<span class="st">&quot;PL: +{round(painted_lane_len_km, 1)} km&quot;</span>),</span>
<span id="cb11-97"><a href="#cb11-97" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(cycle_track_len_km)</span>
<span id="cb11-98"><a href="#cb11-98" tabindex="-1"></a>                <span class="sc">~</span> <span class="fu">glue</span>(<span class="st">&quot;CT: +{round(cycle_track_len_km, 1)} km&quot;</span>),</span>
<span id="cb11-99"><a href="#cb11-99" tabindex="-1"></a>            <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb11-100"><a href="#cb11-100" tabindex="-1"></a>        ),</span>
<span id="cb11-101"><a href="#cb11-101" tabindex="-1"></a>        <span class="at">type_year =</span> <span class="fu">if_else</span>(</span>
<span id="cb11-102"><a href="#cb11-102" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(painted_lane_len_km) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(cycle_track_len_km),</span>
<span id="cb11-103"><a href="#cb11-103" tabindex="-1"></a>            year,</span>
<span id="cb11-104"><a href="#cb11-104" tabindex="-1"></a>            <span class="cn">NA</span></span>
<span id="cb11-105"><a href="#cb11-105" tabindex="-1"></a>        ),</span>
<span id="cb11-106"><a href="#cb11-106" tabindex="-1"></a>        <span class="at">type_date =</span> <span class="fu">if_else</span>(</span>
<span id="cb11-107"><a href="#cb11-107" tabindex="-1"></a>            <span class="sc">!</span><span class="fu">is.na</span>(painted_lane_len_km) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(cycle_track_len_km),</span>
<span id="cb11-108"><a href="#cb11-108" tabindex="-1"></a>            <span class="fu">as_date</span>(<span class="fu">glue</span>(<span class="st">&quot;{year}-01-01&quot;</span>)),</span>
<span id="cb11-109"><a href="#cb11-109" tabindex="-1"></a>            <span class="cn">NA</span></span>
<span id="cb11-110"><a href="#cb11-110" tabindex="-1"></a>        )</span>
<span id="cb11-111"><a href="#cb11-111" tabindex="-1"></a>    )</span>
<span id="cb11-112"><a href="#cb11-112" tabindex="-1"></a></span>
<span id="cb11-113"><a href="#cb11-113" tabindex="-1"></a><span class="co"># Get bike lens</span></span>
<span id="cb11-114"><a href="#cb11-114" tabindex="-1"></a>bike_len <span class="ot">&lt;-</span> bike <span class="sc">%&gt;%</span></span>
<span id="cb11-115"><a href="#cb11-115" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb11-116"><a href="#cb11-116" tabindex="-1"></a>        <span class="at">street_orig =</span> street,</span>
<span id="cb11-117"><a href="#cb11-117" tabindex="-1"></a>        <span class="at">street =</span> target_street</span>
<span id="cb11-118"><a href="#cb11-118" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-119"><a href="#cb11-119" tabindex="-1"></a>    <span class="fu">group_by</span>(street) <span class="sc">%&gt;%</span></span>
<span id="cb11-120"><a href="#cb11-120" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb11-121"><a href="#cb11-121" tabindex="-1"></a>        <span class="at">street_len_km =</span> <span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">st_length</span>(geometry)), <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb11-122"><a href="#cb11-122" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-123"><a href="#cb11-123" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-124"><a href="#cb11-124" tabindex="-1"></a>        <span class="at">street_label =</span> <span class="fu">glue</span>(<span class="st">&quot;{street} ({round(street_len_km, 1)} km)&quot;</span>)</span>
<span id="cb11-125"><a href="#cb11-125" tabindex="-1"></a>    )</span>
<span id="cb11-126"><a href="#cb11-126" tabindex="-1"></a></span>
<span id="cb11-127"><a href="#cb11-127" tabindex="-1"></a><span class="co"># Add bike events and lens to plot data</span></span>
<span id="cb11-128"><a href="#cb11-128" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb11-129"><a href="#cb11-129" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb11-130"><a href="#cb11-130" tabindex="-1"></a>        bike_events,</span>
<span id="cb11-131"><a href="#cb11-131" tabindex="-1"></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;street&quot;</span>, <span class="st">&quot;year&quot;</span>)</span>
<span id="cb11-132"><a href="#cb11-132" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-133"><a href="#cb11-133" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb11-134"><a href="#cb11-134" tabindex="-1"></a>        bike_len,</span>
<span id="cb11-135"><a href="#cb11-135" tabindex="-1"></a>        <span class="at">by =</span> <span class="st">&quot;street&quot;</span></span>
<span id="cb11-136"><a href="#cb11-136" tabindex="-1"></a>    )</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Function to generate plot</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>plot_colli <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>        <span class="at">df =</span> plot_data,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>        <span class="at">y_title =</span> <span class="st">&quot;Injuries&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>        <span class="at">title =</span> <span class="cn">NULL</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>) {</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    </span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>    <span class="co"># Generate vline label</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>    has_ct <span class="ot">&lt;-</span> <span class="sc">!</span>(df <span class="sc">%&gt;%</span> <span class="fu">pull</span>(cycle_track_year) <span class="sc">%&gt;%</span> <span class="fu">is.na</span>(.) <span class="sc">%&gt;%</span> all)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    has_pl <span class="ot">&lt;-</span> <span class="sc">!</span>(df <span class="sc">%&gt;%</span> <span class="fu">pull</span>(painted_lane_year) <span class="sc">%&gt;%</span> <span class="fu">is.na</span>(.) <span class="sc">%&gt;%</span> all)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    vlabel <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>        has_ct <span class="sc">&amp;</span> has_pl <span class="sc">~</span> <span class="st">&quot;Cycle Track (CT) / Painted Lane (PL)&quot;</span>,</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>        has_ct <span class="sc">~</span> <span class="st">&quot;Cycle Track (CT)&quot;</span>,</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>        has_pl <span class="sc">~</span> <span class="st">&quot;Painted Lane (PL)&quot;</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    )</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>    </span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>    <span class="co"># Generate plot</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>    <span class="fu">ggplot</span>(</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>        df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">vline_label =</span> <span class="fu">glue</span>(<span class="st">&quot;{vlabel} Added&quot;</span>)),</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">x =</span> quarter_date, <span class="at">y =</span> n)</span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>        <span class="fu">geom_vline</span>(</span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xintercept =</span> type_date, <span class="at">color =</span> vline_label),</span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>        <span class="fu">geom_label</span>(</span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>            <span class="fu">aes</span>(</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a>                <span class="at">x =</span> type_date,</span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>                <span class="at">label =</span> type_label</span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a>            ),</span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;gray30&quot;</span>,</span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a>            <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a>            <span class="at">y =</span> <span class="fu">max</span>(df<span class="sc">$</span>n <span class="sc">*</span> <span class="fl">1.4</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a>        <span class="fu">geom_line</span>(</span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;gray70&quot;</span>,</span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a>        <span class="fu">geom_text</span>(</span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> n),</span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;gray10&quot;</span>,</span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a>            <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb12-47"><a href="#cb12-47" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb12-48"><a href="#cb12-48" tabindex="-1"></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-49"><a href="#cb12-49" tabindex="-1"></a>        <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="st">&quot;gray30&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-50"><a href="#cb12-50" tabindex="-1"></a>        <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&quot;1 year&quot;</span>, <span class="at">date_labels =</span> <span class="st">&quot;%Y&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-51"><a href="#cb12-51" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.75</span>))) <span class="sc">+</span></span>
<span id="cb12-52"><a href="#cb12-52" tabindex="-1"></a>        <span class="fu">labs</span>(</span>
<span id="cb12-53"><a href="#cb12-53" tabindex="-1"></a>            <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb12-54"><a href="#cb12-54" tabindex="-1"></a>            <span class="at">y =</span> y_title,</span>
<span id="cb12-55"><a href="#cb12-55" tabindex="-1"></a>            <span class="at">title =</span> title</span>
<span id="cb12-56"><a href="#cb12-56" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb12-57"><a href="#cb12-57" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb12-58"><a href="#cb12-58" tabindex="-1"></a>            <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb12-59"><a href="#cb12-59" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb12-60"><a href="#cb12-60" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb12-61"><a href="#cb12-61" tabindex="-1"></a>            <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>),</span>
<span id="cb12-62"><a href="#cb12-62" tabindex="-1"></a>            <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb12-63"><a href="#cb12-63" tabindex="-1"></a>        )</span>
<span id="cb12-64"><a href="#cb12-64" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Generate street and user combo for plots</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>plot_combos <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    <span class="at">street =</span> <span class="fu">unique</span>(plot_data<span class="sc">$</span>street),</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="at">user =</span> <span class="fu">unique</span>(plot_data<span class="sc">$</span>user)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># Create folder to store plots</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;../../figures/collisions-bloorunidanyonge&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co"># Plot by street and user</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(plot_combos)) {</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    </span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    <span class="co"># Get street and user combo</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    streeti <span class="ot">&lt;-</span> <span class="fu">as.character</span>(plot_combos<span class="sc">$</span>street[i])</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>    useri <span class="ot">&lt;-</span> <span class="fu">as.character</span>(plot_combos<span class="sc">$</span>user[i])</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>    </span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>    <span class="co"># Prep plot data for street and user</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>    df <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>        <span class="fu">filter</span>(user <span class="sc">==</span> useri <span class="sc">&amp;</span> street <span class="sc">==</span> streeti)</span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>    </span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>    <span class="co"># Generate the plot for street and user</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>    useri_label <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>        useri <span class="sc">==</span> <span class="st">&quot;Pedestrian&quot;</span> <span class="sc">~</span> <span class="st">&quot;Pedestrians&quot;</span>,</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>        useri <span class="sc">==</span> <span class="st">&quot;Driver&quot;</span> <span class="sc">~</span> <span class="st">&quot;Car Occupants&quot;</span>,</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>        useri <span class="sc">==</span> <span class="st">&quot;Cyclist&quot;</span> <span class="sc">~</span> <span class="st">&quot;Bicycle Occupants&quot;</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>    )</span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot_colli</span>(</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>        df,</span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>        <span class="at">title =</span> df<span class="sc">$</span>street_label <span class="sc">%&gt;%</span> unique,</span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>        <span class="at">y_title =</span> <span class="fu">glue</span>(<span class="st">&quot;{useri_label} (n={sum(df$n, na.rm = T)})&quot;</span>)</span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>    )</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a>    </span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a>    <span class="co"># Save the plot</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a>    streeti_file <span class="ot">&lt;-</span> <span class="fu">str_split_i</span>(<span class="fu">as.character</span>(streeti), <span class="st">&quot; &quot;</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a>        str_to_lower</span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a>    useri_file <span class="ot">&lt;-</span> <span class="fu">str_to_lower</span>(useri)</span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a>    <span class="fu">ggsave</span>(</span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a>        <span class="fu">glue</span>(</span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a>            <span class="st">&quot;../../figures/collisions-bloorunidanyonge/&quot;</span>,</span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a>            <span class="st">&quot;toronto-collisions-{streeti_file}-{useri_file}.png&quot;</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a>        ),</span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a>        <span class="at">plot =</span> p,</span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a>        <span class="at">height =</span> <span class="fl">4.5</span>,</span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a>        <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a>    )</span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a>    </span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a>    <span class="co"># Create section and display plot</span></span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n\n\n\n</span><span class="st">### &quot;</span>, streeti, <span class="st">&quot; (&quot;</span>, useri, <span class="st">&quot;)</span><span class="sc">\n\n\n\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb13-50"><a href="#cb13-50" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n\n\n\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-51"><a href="#cb13-51" tabindex="-1"></a>    <span class="fu">print</span>(p)</span>
<span id="cb13-52"><a href="#cb13-52" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n\n\n\n</span><span class="st">&quot;</span>)</span>
<span id="cb13-53"><a href="#cb13-53" tabindex="-1"></a>    </span>
<span id="cb13-54"><a href="#cb13-54" tabindex="-1"></a>}</span></code></pre></div>
<div id="bloor-street-cyclist" class="section level3">
<h3>Bloor Street (Cyclist)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-1.png" width="768" /></p>
</div>
<div id="danforth-streetavenue-cyclist" class="section level3">
<h3>Danforth Street/Avenue (Cyclist)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-2.png" width="768" /></p>
</div>
<div id="university-avenue-cyclist" class="section level3">
<h3>University Avenue (Cyclist)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-3.png" width="768" /></p>
</div>
<div id="yonge-street-cyclist" class="section level3">
<h3>Yonge Street (Cyclist)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-4.png" width="768" /></p>
</div>
<div id="bloor-street-driver" class="section level3">
<h3>Bloor Street (Driver)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-5.png" width="768" /></p>
</div>
<div id="danforth-streetavenue-driver" class="section level3">
<h3>Danforth Street/Avenue (Driver)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-6.png" width="768" /></p>
</div>
<div id="university-avenue-driver" class="section level3">
<h3>University Avenue (Driver)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-7.png" width="768" /></p>
</div>
<div id="yonge-street-driver" class="section level3">
<h3>Yonge Street (Driver)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-8.png" width="768" /></p>
</div>
<div id="bloor-street-pedestrian" class="section level3">
<h3>Bloor Street (Pedestrian)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-9.png" width="768" /></p>
</div>
<div id="danforth-streetavenue-pedestrian" class="section level3">
<h3>Danforth Street/Avenue (Pedestrian)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-10.png" width="768" /></p>
</div>
<div id="university-avenue-pedestrian" class="section level3">
<h3>University Avenue (Pedestrian)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-11.png" width="768" /></p>
</div>
<div id="yonge-street-pedestrian" class="section level3">
<h3>Yonge Street (Pedestrian)</h3>
<p><img src="index_files/figure-html/toronto-collisions-bloorunidanyonge-plots-12.png" width="768" /></p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
